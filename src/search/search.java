package search;

import java.awt.Color;
import javax.swing.text.BadLocationException;
import javax.swing.text.DefaultHighlighter;
import javax.swing.text.Highlighter;

public class search extends javax.swing.JFrame {

    public search() {
        initComponents();
    }

    /**
     * This method is called from within the constructor to initialize the form.
     * WARNING: Do NOT modify this code. The content of this method is always
     * regenerated by the Form Editor.
     */
    @SuppressWarnings("unchecked")
    // <editor-fold defaultstate="collapsed" desc="Generated Code">//GEN-BEGIN:initComponents
    private void initComponents() {

        searchPanel = new javax.swing.JPanel();
        searchField = new javax.swing.JTextField();
        occuranceText = new javax.swing.JLabel();
        textScrollPane = new javax.swing.JScrollPane();
        textArea = new javax.swing.JTextArea();

        setDefaultCloseOperation(javax.swing.WindowConstants.EXIT_ON_CLOSE);
        setTitle("Highlight Searching Example");

        searchField.setText("Search for anything...");
        searchField.addFocusListener(new java.awt.event.FocusAdapter() {
            public void focusLost(java.awt.event.FocusEvent evt) {
                searchFieldFocusLost(evt);
            }
        });
        searchField.addMouseListener(new java.awt.event.MouseAdapter() {
            public void mouseClicked(java.awt.event.MouseEvent evt) {
                searchFieldMouseClicked(evt);
            }
        });
        searchField.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                searchFieldActionPerformed(evt);
            }
        });
        searchField.addKeyListener(new java.awt.event.KeyAdapter() {
            public void keyTyped(java.awt.event.KeyEvent evt) {
                searchFieldKeyTyped(evt);
            }
        });

        occuranceText.setText("Number of Occurences: 0");

        javax.swing.GroupLayout searchPanelLayout = new javax.swing.GroupLayout(searchPanel);
        searchPanel.setLayout(searchPanelLayout);
        searchPanelLayout.setHorizontalGroup(
            searchPanelLayout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGroup(searchPanelLayout.createSequentialGroup()
                .addContainerGap()
                .addComponent(searchField, javax.swing.GroupLayout.PREFERRED_SIZE, 365, javax.swing.GroupLayout.PREFERRED_SIZE)
                .addGap(18, 18, 18)
                .addComponent(occuranceText)
                .addContainerGap(169, Short.MAX_VALUE))
        );
        searchPanelLayout.setVerticalGroup(
            searchPanelLayout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGroup(searchPanelLayout.createSequentialGroup()
                .addGap(14, 14, 14)
                .addGroup(searchPanelLayout.createParallelGroup(javax.swing.GroupLayout.Alignment.BASELINE)
                    .addComponent(searchField, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE)
                    .addComponent(occuranceText))
                .addContainerGap(8, Short.MAX_VALUE))
        );

        textArea.setEditable(false);
        textArea.setColumns(20);
        textArea.setRows(5);
        textArea.setText("Lorem ipsum dolor sit amet, consectetur adipiscing elit. Nulla lorem velit, egestas ac posuere blandit, varius nec sapien. Ut fermentum dui ex, vitae tristique ex gravida vel. Donec tortor nisl, fringilla a odio volutpat, ornare malesuada augue. Suspendisse ut ultricies augue, at ultrices magna. Duis faucibus mollis diam, non tincidunt velit eleifend non. Quisque ac nibh ex. Fusce sit amet justo eu est sollicitudin sagittis vel eu est. Morbi libero nisl, congue et convallis sed, luctus nec ante. Nam ornare efficitur finibus. Vivamus elementum, lectus quis feugiat tempor, ante augue suscipit ex, sit amet convallis ipsum diam quis tellus. Donec pharetra ornare nibh, eget molestie mi ultrices ut. Cras eu quam luctus nulla posuere euismod eget pharetra leo.\n\nVivamus vulputate elit at lorem posuere aliquam at at tortor. Sed in erat nec sapien tincidunt malesuada sit amet sit amet tellus. Mauris tincidunt orci eget ultrices tincidunt. Mauris sollicitudin mattis odio, ultricies molestie mauris tristique et. Aenean finibus tortor neque, quis tincidunt ipsum placerat a. Praesent nec vestibulum quam, eget tempor lorem. Suspendisse libero ex, semper et leo vitae, cursus dapibus neque. In tristique enim eu arcu pharetra, vitae faucibus arcu volutpat. Curabitur consectetur auctor fermentum.\n\nPellentesque placerat imperdiet ullamcorper. Proin a justo ac eros lacinia aliquam vel auctor libero. Aliquam nec lorem vel magna tincidunt lacinia non sed massa. Praesent nec quam nisl. Maecenas tristique sem nec lorem finibus fringilla. Etiam efficitur venenatis commodo. Fusce imperdiet semper sapien vulputate condimentum. Vestibulum laoreet porttitor turpis, cursus molestie libero tincidunt ut.\n\nPellentesque lobortis semper risus in lacinia. Nunc in eros quis felis viverra pharetra. Phasellus leo dolor, consequat vitae ipsum non, viverra rhoncus ante. Curabitur efficitur arcu sit amet nunc ultricies euismod. Praesent est metus, imperdiet a justo in, accumsan consequat sem. Ut at elit sit amet nisl tempus fringilla ut quis mi. Aenean vehicula blandit ipsum, sit amet viverra ex vehicula non. Etiam scelerisque, nunc ac placerat semper, massa odio lacinia libero, non consequat nisl tortor eu felis.\n\nSed sollicitudin consequat velit eu semper. Integer et tortor aliquet, fringilla velit quis, efficitur risus. In at mi diam. Vivamus id tellus eu purus tristique congue. Quisque cursus dictum purus sed bibendum. Curabitur eu dictum quam, eget finibus nisl. Maecenas a lectus tincidunt, finibus lacus at, scelerisque ex. Donec in diam in augue gravida efficitur non ut orci. Sed sollicitudin arcu in convallis imperdiet. Nullam eros magna, blandit vitae mauris sit amet, finibus condimentum nibh. Proin vehicula eget mi at ullamcorper. Quisque consectetur laoreet massa ut viverra. Curabitur suscipit ligula massa, non pulvinar lectus ultrices ac. Etiam a diam rutrum, faucibus diam a, ullamcorper dolor.\n\nLorem ipsum dolor sit amet, consectetur adipiscing elit. Nulla lorem velit, egestas ac posuere blandit, varius nec sapien. Ut fermentum dui ex, vitae tristique ex gravida vel. Donec tortor nisl, fringilla a odio volutpat, ornare malesuada augue. Suspendisse ut ultricies augue, at ultrices magna. Duis faucibus mollis diam, non tincidunt velit eleifend non. Quisque ac nibh ex. Fusce sit amet justo eu est sollicitudin sagittis vel eu est. Morbi libero nisl, congue et convallis sed, luctus nec ante. Nam ornare efficitur finibus. Vivamus elementum, lectus quis feugiat tempor, ante augue suscipit ex, sit amet convallis ipsum diam quis tellus. Donec pharetra ornare nibh, eget molestie mi ultrices ut. Cras eu quam luctus nulla posuere euismod eget pharetra leo.\n\nVivamus vulputate elit at lorem posuere aliquam at at tortor. Sed in erat nec sapien tincidunt malesuada sit amet sit amet tellus. Mauris tincidunt orci eget ultrices tincidunt. Mauris sollicitudin mattis odio, ultricies molestie mauris tristique et. Aenean finibus tortor neque, quis tincidunt ipsum placerat a. Praesent nec vestibulum quam, eget tempor lorem. Suspendisse libero ex, semper et leo vitae, cursus dapibus neque. In tristique enim eu arcu pharetra, vitae faucibus arcu volutpat. Curabitur consectetur auctor fermentum.\n\nPellentesque placerat imperdiet ullamcorper. Proin a justo ac eros lacinia aliquam vel auctor libero. Aliquam nec lorem vel magna tincidunt lacinia non sed massa. Praesent nec quam nisl. Maecenas tristique sem nec lorem finibus fringilla. Etiam efficitur venenatis commodo. Fusce imperdiet semper sapien vulputate condimentum. Vestibulum laoreet porttitor turpis, cursus molestie libero tincidunt ut.\n\nPellentesque lobortis semper risus in lacinia. Nunc in eros quis felis viverra pharetra. Phasellus leo dolor, consequat vitae ipsum non, viverra rhoncus ante. Curabitur efficitur arcu sit amet nunc ultricies euismod. Praesent est metus, imperdiet a justo in, accumsan consequat sem. Ut at elit sit amet nisl tempus fringilla ut quis mi. Aenean vehicula blandit ipsum, sit amet viverra ex vehicula non. Etiam scelerisque, nunc ac placerat semper, massa odio lacinia libero, non consequat nisl tortor eu felis.\n\nSed sollicitudin consequat velit eu semper. Integer et tortor aliquet, fringilla velit quis, efficitur risus. In at mi diam. Vivamus id tellus eu purus tristique congue. Quisque cursus dictum purus sed bibendum. Curabitur eu dictum quam, eget finibus nisl. Maecenas a lectus tincidunt, finibus lacus at, scelerisque ex. Donec in diam in augue gravida efficitur non ut orci. Sed sollicitudin arcu in convallis imperdiet. Nullam eros magna, blandit vitae mauris sit amet, finibus condimentum nibh. Proin vehicula eget mi at ullamcorper. Quisque consectetur laoreet massa ut viverra. Curabitur suscipit ligula massa, non pulvinar lectus ultrices ac. Etiam a diam rutrum, faucibus diam a, ullamcorper dolor.\n\nLorem ipsum dolor sit amet, consectetur adipiscing elit. Nulla lorem velit, egestas ac posuere blandit, varius nec sapien. Ut fermentum dui ex, vitae tristique ex gravida vel. Donec tortor nisl, fringilla a odio volutpat, ornare malesuada augue. Suspendisse ut ultricies augue, at ultrices magna. Duis faucibus mollis diam, non tincidunt velit eleifend non. Quisque ac nibh ex. Fusce sit amet justo eu est sollicitudin sagittis vel eu est. Morbi libero nisl, congue et convallis sed, luctus nec ante. Nam ornare efficitur finibus. Vivamus elementum, lectus quis feugiat tempor, ante augue suscipit ex, sit amet convallis ipsum diam quis tellus. Donec pharetra ornare nibh, eget molestie mi ultrices ut. Cras eu quam luctus nulla posuere euismod eget pharetra leo.\n\nVivamus vulputate elit at lorem posuere aliquam at at tortor. Sed in erat nec sapien tincidunt malesuada sit amet sit amet tellus. Mauris tincidunt orci eget ultrices tincidunt. Mauris sollicitudin mattis odio, ultricies molestie mauris tristique et. Aenean finibus tortor neque, quis tincidunt ipsum placerat a. Praesent nec vestibulum quam, eget tempor lorem. Suspendisse libero ex, semper et leo vitae, cursus dapibus neque. In tristique enim eu arcu pharetra, vitae faucibus arcu volutpat. Curabitur consectetur auctor fermentum.\n\nPellentesque placerat imperdiet ullamcorper. Proin a justo ac eros lacinia aliquam vel auctor libero. Aliquam nec lorem vel magna tincidunt lacinia non sed massa. Praesent nec quam nisl. Maecenas tristique sem nec lorem finibus fringilla. Etiam efficitur venenatis commodo. Fusce imperdiet semper sapien vulputate condimentum. Vestibulum laoreet porttitor turpis, cursus molestie libero tincidunt ut.\n\nPellentesque lobortis semper risus in lacinia. Nunc in eros quis felis viverra pharetra. Phasellus leo dolor, consequat vitae ipsum non, viverra rhoncus ante. Curabitur efficitur arcu sit amet nunc ultricies euismod. Praesent est metus, imperdiet a justo in, accumsan consequat sem. Ut at elit sit amet nisl tempus fringilla ut quis mi. Aenean vehicula blandit ipsum, sit amet viverra ex vehicula non. Etiam scelerisque, nunc ac placerat semper, massa odio lacinia libero, non consequat nisl tortor eu felis.\n\nSed sollicitudin consequat velit eu semper. Integer et tortor aliquet, fringilla velit quis, efficitur risus. In at mi diam. Vivamus id tellus eu purus tristique congue. Quisque cursus dictum purus sed bibendum. Curabitur eu dictum quam, eget finibus nisl. Maecenas a lectus tincidunt, finibus lacus at, scelerisque ex. Donec in diam in augue gravida efficitur non ut orci. Sed sollicitudin arcu in convallis imperdiet. Nullam eros magna, blandit vitae mauris sit amet, finibus condimentum nibh. Proin vehicula eget mi at ullamcorper. Quisque consectetur laoreet massa ut viverra. Curabitur suscipit ligula massa, non pulvinar lectus ultrices ac. Etiam a diam rutrum, faucibus diam a, ullamcorper dolor.\n\n");
        textScrollPane.setViewportView(textArea);

        javax.swing.GroupLayout layout = new javax.swing.GroupLayout(getContentPane());
        getContentPane().setLayout(layout);
        layout.setHorizontalGroup(
            layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addComponent(searchPanel, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE)
            .addComponent(textScrollPane)
        );
        layout.setVerticalGroup(
            layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGroup(layout.createSequentialGroup()
                .addComponent(searchPanel, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE)
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                .addComponent(textScrollPane, javax.swing.GroupLayout.DEFAULT_SIZE, 522, Short.MAX_VALUE))
        );

        pack();
    }// </editor-fold>//GEN-END:initComponents

    private void searchFieldActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_searchFieldActionPerformed
        if(searchField.getText().equals("Search for anything...")) {
            searchField.setText("");
        }
    }//GEN-LAST:event_searchFieldActionPerformed

    private void searchFieldMouseClicked(java.awt.event.MouseEvent evt) {//GEN-FIRST:event_searchFieldMouseClicked
        if(searchField.getText().equals("Search for anything...")) {
            searchField.setText("");
        }
    }//GEN-LAST:event_searchFieldMouseClicked

    private void searchFieldFocusLost(java.awt.event.FocusEvent evt) {//GEN-FIRST:event_searchFieldFocusLost
        if(searchField.getText().equals("")) {
            searchField.setText("Search for anything...");
        }
    }//GEN-LAST:event_searchFieldFocusLost

    /**
     * Support for keyword searching with highlights that match search test.
     * Loosely based on: http://stackoverflow.com/a/6531715
     * @param evt - The key press & release.
     */
    private void searchFieldKeyTyped(java.awt.event.KeyEvent evt) {//GEN-FIRST:event_searchFieldKeyTyped
        // The string we are trying to highlight
        String highlightThis;

        /**
         * Hack-y solution to problem where highlights only work for length-1
         * or ie. does not include the most recent character typed. This is a
         * problem as the current highlights do not accurately reflect what 
         * is in the text field. 
         */
        if( Character.isLetter(evt.getKeyChar()) || Character.isDigit(evt.getKeyChar())){
            highlightThis = searchField.getText() + Character.toString(evt.getKeyChar());
        }
        // Ignore all characters that are not letters or numbers
        else{
            highlightThis = searchField.getText();
        }
        highlightMatches(highlightThis);
    }//GEN-LAST:event_searchFieldKeyTyped

    /**
     * This function acts as the main logic for keyword searching and highlighting.
     * @param highlightThis - The string to highlight within the textArea
     */
    private void highlightMatches(String highlightThis){
        // Try to highlight matches of keyword search
        try {
            // The length of the amount of text in the text window
            int textLength = textArea.getDocument().getLength();
            // Store the entire contents of the text window in one string
            String text = textArea.getDocument().getText(0, textLength);
            // Initialize our cyan highlighter object
            Highlighter.HighlightPainter painter = new
                DefaultHighlighter.DefaultHighlightPainter(Color.cyan);
            
            // If text exists and there is something to highlight...
            if(! searchField.getText().equals("") ||! highlightThis.equals("") ){                                
                // Where do we begin the highlight?
                int offset = text.indexOf(highlightThis);
                // How far does the highlight go?
                int length = highlightThis.length();
                // Since the search string has changed, remove old highlights
                textArea.getHighlighter().removeAllHighlights();
                // For all instances where we can highlight
                while (offset != -1){
                    // Highlight from beginning to end with cyan
                    textArea.getHighlighter().addHighlight(offset, offset + length, painter);
                    // Get the next instance
                    offset = text.indexOf(highlightThis, offset+1);
                }
                // After highlights done, update count of highlights
                occuranceText.setText("Number of Occurences: " + 
                        textArea.getHighlighter().getHighlights().length);
            }
            // If there is nothing in the text field, remove highlights & reset count
            else{
                textArea.getHighlighter().removeAllHighlights();
                occuranceText.setText("Number of Occurences: 0");                
            }
        // Unless the location of a highlight is invalid
        } catch (BadLocationException ex) {
            textArea.append(ex.toString());
        }                         
    }   
    
    /**
     * @param args the command line arguments
     */
    public static void main(String args[]) {
        /* Set the Nimbus look and feel */
        //<editor-fold defaultstate="collapsed" desc=" Look and feel setting code (optional) ">
        /* If Nimbus (introduced in Java SE 6) is not available, stay with the default look and feel.
         * For details see http://download.oracle.com/javase/tutorial/uiswing/lookandfeel/plaf.html 
         */
        try {
            for (javax.swing.UIManager.LookAndFeelInfo info : javax.swing.UIManager.getInstalledLookAndFeels()) {
                if ("Nimbus".equals(info.getName())) {
                    javax.swing.UIManager.setLookAndFeel(info.getClassName());
                    break;
                }
            }
        } catch (ClassNotFoundException ex) {
            java.util.logging.Logger.getLogger(search.class.getName()).log(java.util.logging.Level.SEVERE, null, ex);
        } catch (InstantiationException ex) {
            java.util.logging.Logger.getLogger(search.class.getName()).log(java.util.logging.Level.SEVERE, null, ex);
        } catch (IllegalAccessException ex) {
            java.util.logging.Logger.getLogger(search.class.getName()).log(java.util.logging.Level.SEVERE, null, ex);
        } catch (javax.swing.UnsupportedLookAndFeelException ex) {
            java.util.logging.Logger.getLogger(search.class.getName()).log(java.util.logging.Level.SEVERE, null, ex);
        }
        //</editor-fold>

        /* Create and display the form */
        java.awt.EventQueue.invokeLater(new Runnable() {
            public void run() {
                new search().setVisible(true);
            }
        });
    }

    // Variables declaration - do not modify//GEN-BEGIN:variables
    private javax.swing.JLabel occuranceText;
    private javax.swing.JTextField searchField;
    private javax.swing.JPanel searchPanel;
    private javax.swing.JTextArea textArea;
    private javax.swing.JScrollPane textScrollPane;
    // End of variables declaration//GEN-END:variables
}
